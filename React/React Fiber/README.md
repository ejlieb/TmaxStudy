# React Fiber



##### What is React Fiber?

Fiber는 React v16에서 리액트의 핵심알고리즘을 재구성 재조정(Reconciliation) 엔진이다.

Fiber의 목표는 애니메이션, 레이아웃, 제스처, 중단 또는 재사용 기능과 같은 영역에 대한 적합성을 높이고 다양한 유형의 업데이트에 우선 순위를 지정하는 것이다.



**가장 핵심 기능은 렌더링을 증분하는 것 = 렌더링 작업을 여러 덩어리로 나누어 여러 프레임에 분산하는 기능**



i) 중단 가능한 작업을 덩어리로 나누기

ii) 진행 중인 작업의 우선순위를 지정하고, 리베이스하고 재사용

iii) 리액트의 레이아웃을 지원하기 위한 부모 자식 간의 yield back and forth

iv) `redner()`로부터 다수 엘리먼트들을 반환

v) 에러 바운더리에 대한 더 나은 지원



##### Virtual DOM

Virtual DOM은 Real DOM의 in-memory 표현

UI 표현이 메모리에 저장되며 Real DOM과 동기화

이러한 전체 과정을 재조정(Reconciliation)이라고 한다.



Virtual DOM은 기술보다는 패턴에 가깝고, React에서는 UI를 나타내는 객체로 통용되어 React elements와 연관된다.



React는 컴포넌트 트리에 대한 추가정보를 포함하기 위해  **fibers**라는 내부 객체를 사용한다.

Virtual DOM은 브라우저 API위에 있는 Javascript 라이브러리에서 구현되는 개념!

 

##### Reconciliation

React가 변경해야 할 부분을 결정하기 위해 한 트리를 다른 트리와 비교하는 데 사용하는 알고리즘



React API의 핵심 아이디어는 업데이트를 통해 전체 앱을 다시 렌더링하도록 하는 것

이를 통해 개발자는 앱을 다른상태로 효율적으로 전환하는 방법에 대해서는 걱정하지 않고 선언적 개발이 가능하다.



하지만 문제는 각 변경사항마다 전체앱을 재렌더하면 성능이 저하된다는 점이다.



그렇기 때문에 성능을 유지하면서 전체 앱을 리렌더링할 수 있는 최적화 방법이 재조정 과정에 포함되었다.



1. React 애플리케이션을 렌더하면 앱을 묘사하는 노드의 트리가 생성되어 메모리에 저장
2. 트리는 렌더링 환경으로 전달( ex) 브라우저 환경이라면 DOM 조작으로 변환) 
3. 앱이 업데이트되면 새 트리가 생성 / 새 트리는 이전의 트리와 구분된다



이때 알고리즘은 다음과 같다

- 컴포넌트 타입이 다르면 실질적으로 다른 트리를 생성한다고 가정. 따라서 리액트는 이를 구분하지 않고 이전의 트리를 완전히 교체
- 목록은 kety를 통해 구분. 따라서 key는 안정적이고 예측가능하고 유니크해야한다.



##### Reconciliation과 Rendering

React에서는 재조정과 렌더링의 단계가 별개이다.

- Reconciler는 트리의 어떤 부분이 변경되었는지를 계산

- 이후 Render는 계산된 정보를 통해 앱을 실제로 업데이트



이렇게 둘을 분리하게 되면 React DOM과 React Native가 React Core에서 제공하는 동일한 Reconciler를 공유하면서 자체적인 Renderer를 사용할 수 있다.



Fiber는 Reconciler를 재구현하는 역할이다.

- UI에서 모든 업데이트를 즉시 적용할 필요는 없다
- 다른 유형의 업데이트들은 우선순위가 다르다
- push 기반 접근법은 개발자가 스케쥴 일정을 결정해야하지만 pull 기반 접근법은 react가 대신한다.



그래서 스케쥴링의 이점을 활용하기 위해 React의 핵심 알고리즘을 정비하는 것이 Fiber이다.



##### Fiber





